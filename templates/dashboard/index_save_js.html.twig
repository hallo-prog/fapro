{% extends 'base.html.twig' %}
    {% set year = year is defined ? year : '2023' %}
{% block body_faq %}{% endblock %}
{% block javascripts %}
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    {{ parent() }}

    {# https://cdn.jsdelivr.net/npm/cdbootstrap/js/cdb.min.js #}
    {# https://cdn.jsdelivr.net/npm/cdbootstrap/js/bootstrap.min.js #}
    {# https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js #}
    <script src="{{ asset('assets/js/cbd.js') }}"></script>
{#    <script src="{{ asset('app/bootstrap-4.0.0/dist/js/bootstrap.min.js') }}"></script>#}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ asset('assets/js/chart.min.js') }}?p=1"></script>
    <script>
        jQuery(document).ready(function () {
            $('#tabber').on('change', function () {
                let id = $(this).val();
                $('.tab-pane').removeClass('active')
                $('#'+id).addClass('active')
            });
            jQuery('#slacktime').datetimepicker({timepicker:true,'format': 'd.m.Y H:i'});
            $(document).on('click', '.slack_icon', function () {
                console.log($(this).attr('data-source'));
                console.log(toastui);
            });
         })

    </script>
    {% if is_granted('ROLE_ADMIN') %}
    <script>
        let colors = [
            '#F7464A',
            '#468df7',
            '#58f746',
            '#cb46f7',
            '#f7b946',
            '#9d2b2e',
            '#2b599f',
            '#318a27',
            '#73278c',
            '#856325',
            '#a17071',
            '#5f718d',
            '#6e886b',
            '#81678a',
            '#a8987a',
        ];
        console.log(colors);
        let ctxP = document.getElementById("labelChart2").getContext('2d');
        let myPieChart = new Chart(ctxP, {
            type: 'pie',
            data: {
                labels: [{% for k, o in userOrders %}'{{ k }} ({{ o.send }})',{% endfor %}],
                datasets: [{
                    data: [{% for k, o in userOrders %}{{ o.send }},{% endfor %}],
                    backgroundColor: [{% for k,c in userOrders %}colors[{{ loop.index-1 }}],{% endfor %}],
                    hoverBackgroundColor: [{% for k,c in userOrders %}colors[{{ loop.index-1 }}],{% endfor %}]
                }]
            },
            options: {
                responsive: true,
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        boxWidth: 10
                    }
                },
                plugins: {
                    datalabels: {
                        formatter: (value, ctx) => {
                            let sum = 0;
                            let dataArr = ctx.chart.data.datasets[0].data;
                            dataArr.map(data => {
                                sum += data;
                            });
                            return (value * 100 / sum).toFixed(2) + "%";
                        },
                        color: '#ffffff',
                        labels: {
                            title: {
                                font: {
                                    size: '16'
                                }
                            }
                        }
                    }
                }
            }
        });
        let ctxL = document.getElementById("lineChart").getContext('2d');
        let myLineChart = new Chart(ctxL, {
            type: 'line',
            data: {
                labels: ["{{ 'january'|trans }}", "{{ 'february'|trans }}", "{{ 'march'|trans }}", "{{ 'april'|trans }}", "{{ 'may'|trans }}", "{{ 'juny'|trans }}", "{{ 'july'|trans }}", "{{ 'august'|trans }}", "{{ 'september'|trans }}", "{{ 'october'|trans }}", "{{ 'november'|trans }}", "{{ 'december'|trans }}"],
                datasets: [
                    {
                        label: "Unbezahlt",
                        data: ['{{ unpayedBills(year~'-01') }}',
                            '{{ unpayedBills(year~'-02') }}',
                            '{{ unpayedBills(year~'-03') }}',
                            '{{ unpayedBills(year~'-04') }}',
                            '{{ unpayedBills(year~'-05') }}','{{ unpayedBills(year~'-06') }}','{{ unpayedBills(year~'-07') }}','{{ unpayedBills(year~'-08') }}','{{ unpayedBills(year~'-09') }}','{{ unpayedBills(year~'-10') }}','{{ unpayedBills(year~'-11') }}','{{ unpayedBills(year~'-12') }}'],
                        backgroundColor: [
                            'rgba(255,255,255,0)',
                        ],
                        borderColor: [
                            'rgb(201,31,7)',
                        ],
                        borderWidth: 2
                    },
                    {
                        label: "Abschlagsrechnungen",
                        data: ['{{ payedPartBills(year~'-01', false) }}',
                            '{{ payedPartBills(year~'-02', false) }}',
                            '{{ payedPartBills(year~'-03', false) }}',
                            '{{ payedPartBills(year~'-04', false) }}',
                            '{{ payedPartBills(year~'-05', false) }}','{{ payedPartBills(year~'-06', false) }}','{{ payedPartBills(year~'-07', false) }}','{{ payedPartBills(year~'-08', false) }}','{{ payedPartBills(year~'-09', false) }}','{{ payedPartBills(year~'-10', false) }}','{{ payedPartBills(year~'-11', false) }}','{{ payedPartBills(year~'-12', false) }}'],
                        // backgroundColor: [
                        //     'rgba(149,188,227,0.32)',
                        // ],
                        borderColor: [
                            'rgb(245,114,94)',
                        ],
                        borderWidth: 2
                    },
                    {
                        label: "Teilrechnungen",
                        data: ['{{ payedPartPlusBills(year~'-01', false) }}',
                            '{{ payedPartPlusBills(year~'-02', false) }}',
                            '{{ payedPartPlusBills(year~'-03', false) }}',
                            '{{ payedPartPlusBills(year~'-04', false) }}',
                            '{{ payedPartPlusBills(year~'-05', false) }}','{{ payedPartPlusBills(year~'-06', false) }}','{{ payedPartPlusBills(year~'-07', false) }}','{{ payedPartPlusBills(year~'-08', false) }}','{{ payedPartPlusBills(year~'-09', false) }}','{{ payedPartPlusBills(year~'-10', false) }}','{{ payedPartPlusBills(year~'-11', false) }}','{{ payedPartPlusBills(year~'-12', false) }}'],
                        // backgroundColor: [
                        //     'rgba(48,199,199,0.2)',
                        // ],
                        borderColor: [
                            'rgb(31,185,219)',
                        ],
                        borderWidth: 2
                    },
                    {
                        label: "Abschlussrechnungen",
                        data: ['{{ payedRestBills(year~'-01', false) }}',
                            '{{ payedRestBills(year~'-02', false) }}',
                            '{{ payedRestBills(year~'-03', false) }}',
                            '{{ payedRestBills(year~'-04', false) }}',
                            '{{ payedRestBills(year~'-05', false) }}','{{ payedRestBills(year~'-06', false) }}','{{ payedRestBills(year~'-07', false) }}','{{ payedRestBills(year~'-08', false) }}','{{ payedRestBills(year~'-09', false) }}','{{ payedRestBills(year~'-10', false) }}','{{ payedRestBills(year~'-11', false) }}','{{ payedRestBills(year~'-12', false) }}'],
                        // backgroundColor: [
                        //     'transparent',
                        // ],
                        borderColor: [
                            'rgb(74,192,71)',
                        ],
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true
            }
        });

        $('#cke_editor1').attr('style','display:none');
        $('#cke_editor2').attr('style','display:none');
    </script>
        {# https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js #}
{#        <script src="{{ asset('app/js/editor.js') }}"></script>#}

    {% endif %}
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
{#    <link rel="stylesheet" href="{{ asset('app/bootstrap-4.0.0/dist/css/bootstrap.min.css') }}">#}
{#    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">#}
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <style>
        .btn-primary, .nav-tabs .nav-item .nav-link {
            cursor: pointer;
            margin: 4px;
            box-shadow: rgba(60, 64, 67, 0.3) 0 1px 2px 0, rgba(60, 64, 67, 0.15) 0 1px 3px 1px;
        }
        .nav-tabs .nav-item .nav-link.active {
            background-color: {{ sfColor }};
            color: #fff !important;
            transition: background-color .3s .2s;
        }
        .nav-tabs .nav-item .nav-link, .nav-tabs .nav-item .nav-link:focus, .nav-tabs .nav-item .nav-link:hover {
            font-weight: 600;
            color: #000 !important;
        }
        .nav-tabs .nav-item .nav-link:focus, .nav-tabs .nav-item .nav-link:hover {
            color: #fff !important;

        }
        .col-form-label, .col-form-label p, .form-check-label {font-size: 22px}
        .chart-container {
            width: 50%;
            height: 50%;
            margin: auto;
        }
    </style>
    <style>
        select{height:20px}
        select:focus{height:auto}
        .cke {
            visibility: hidden !important;
        }
       #slack_message {
            padding: 3%;
            vertical-align: middle;
            text-align: center;
            background: limegreen;
            font-size: 22px;
            color: #fff;
        }
    </style>
    {# {{ path('ajax_offer_stats') }} https:\/\/zoomcharts.com\/data\/appl.json {{ path('ajax_update_call', {'offerName':'open'})}} #}
{% endblock %}
{% block main %}
    <div>
        {% if is_granted('ROLE_ADMIN') %}
        <div class="row">
            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <h3 style="text-align: center;font-size: revert;padding: 0 10px;">Rechnungsübersicht</h3>
                    <canvas id="lineChart" style="margin: 20px 0"></canvas>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="card">
                    <h3 style="text-align: center;font-size: revert;padding: 0 10px;">Top Mitarbeiter Anlage Empfehlung ({{ 'now'|date('m.Y') }})</h3>
                    <script src="https://price-static.crypto.com/latest/public/static/widget/index.js"></script>
                    <div
                            id="crypto-widget-CoinList"


                            data-design="modern"
                            data-coin-ids="29,20"></div>
{#                    <canvas id="labelChart2" style="margin: 20px 0"></canvas>#}
                </div>
            </div>
        </div>
        {% endif %}

        {% if userlist|length and (channellist.channels is defined or userlist.members is defined) %}

        <div class="row">
            <div class="col-12">
                <div class="card px-3" data-controller="slack">
                    <div style="display: none">
                    <div id="slack_icons">
    {#                    {% if emojis.emoji is defined %}#}
    {#                    {% for k, e in emojis.emoji %}#}
    {#                        {% if 'alias' not in e %}#}
    {#                            <img class="slack_icon" data-action="click->slack#icon" data-slack-code-param="{{ k }}" style="width: 20px" data-source="{{ k }}" src="{{ e }}">#}
    {#                        {% endif %}#}
    {#                    {% endfor %}#}
    {#                    {% endif %}#}
                    </div>
                </div>
                    <form class="form mb-0">
                        <div class="row">
                            <div class="col-6">
                            <div class="card d-block p-2 mb-0">
                                <input type="radio" name="u" value="1" checked>&nbsp;@Kollegen <small>(mehrfach Auswahl möglich)</small><br>
                                <select id="slack_user" class="w-100 form-control form-check" multiple="multiple" style="width: 100%;min-height: 68px;" data-slack-target="user">
                                    {% if userlist.members is defined %}
                                        {% for k, ul in userlist.members %}
                                            {% if ul.deleted == false and ul.is_bot == false and ul.real_name != 'Slackbot' %}
                                                <option value="{{ ul.id }}"{% if app.user.slackId == ul.id %} selected{% endif %}>{{ ul.real_name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                            <div class="card d-block p-2 mt-2">
                                <input type="radio" name="u" value="2"> #Channel

                                <select class="w-100 form-control" data-slack-target="channel">
                                    {% if channellist.channels is defined %}
                                        {% for k, ul in channellist.channels %}
                                            {% if ul.is_channel == true %}
                                                <option value="{{ ul.id }}">{{ ul.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                        </div>
                            <div class="col-6">
                            <div class="card">
                            <p id="slack_message" style="display: none"></p>

                                <div class="code-html tui-doc-contents">
                                    <div id="slack-m" data-slack-target="message"></div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span style="display: table-cell"><input data-slack-target="urgent" checked type="radio" name="time_shift" value="0">&nbsp;Senden um: </span>
                                <span style="display: table-cell"><input data-slack-target="time" id="slacktime" type="text" class="date form-control" name="time" value="{{ 'now'|date('d.m.Y H:i') }}"></span>
                                <span style="display: table-cell" class="ml-3">&nbsp;&nbsp;&nbsp;&nbsp;<input data-slack-target="urgent" checked type="radio" name="time_shift" value="1">&nbsp;Sofort</span>
                            </div>
                            <div class="col-md-6">
                                <button type="button" style="width: 100%" class="mt-0 btn btn-outline-secondary" data-slack-url-param="{{ path('app_ajax_slacking') }}" data-action="click->slack#slack"><img alt="Slacknachricht senden" style="max-height: 30px;" src="{{ asset('app/img/slack.png') }}"></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{#                <div class="col-lg-12 col-md-12">#}
{#                    <div class="card">#}
{#                        <h1 class="w-100 text-center"><img style="width: 30px;" src="{{ asset('app/images/Atention.png') }}">Ausstehender Zahlungseingang</h1>#}
{#                        <ul class="nav nav-tabs" id="myTab" role="tablist">#}
{#                            <li class="nav-item" role="presentation">#}
{#                                <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Abschlagsrechnungen</button>#}
{#                            </li>#}
{#                            <li class="nav-item" role="presentation">#}
{#                                <button class="nav-link" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Teilrechnungen</button>#}
{#                            </li>#}
{#                            <li class="nav-item" role="presentation">#}
{#                                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Schlussrechnungen</button>#}
{#                            </li>#}
{#                        </ul>#}
{#                        <div class="tab-content" id="myTabContent">#}
{#                            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">#}
{#                                <div class="row">#}
{#                                    {% include 'offer/_offer_block_cover.html.twig' with {'block':'done', 'offers': inquiries, 'storno':false} %}#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">#}
{#                                <div class="row">#}
{#                                    {% include 'offer/_offer_block_cover.html.twig' with {'block':'rechnungEingangSend2', 'offers': inquiries, 'storno':false} %}#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">#}
{#                                <div class="row">#}
{#                                    {% include 'offer/_offer_block_cover.html.twig' with {'block':'rechnungEingangSend', 'offers': inquiries, 'storno':false} %}#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="nav-tabs-navigation">#}
{#                            <div class="nav-tabs-wrapper">#}
{#                                <div class="form-group row">#}
{#                                    <label for="tabber" class="col-6 col-form-label">{{ 'dash.showMeName'|trans }}:</label>#}
{#                                    <div class="col-6">#}
{#                                        <select id="tabber" data-tabs="tabs" class="form-control">#}
{#                                            <option value="work" selected>{{ 'dash.showMe.firstPayed'|trans }}</option>#}
{#                                            <option value="invoicePartSend">{{ 'dash.showMe.partInvoiceToSend'|trans }}</option>#}
{#                                            <option value="invoicePartIn">{{ 'dash.showMe.invoiceToSend'|trans }}</option>#}
{#                                            <option value="invoiceSend">{{ 'dash.showMe.waitPartInvoice'|trans }}</option>#}
{#                                            <option value="invoiceIn">{{ 'dash.showMe.waitInvoice'|trans }}</option>#}
{#                                        </select>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="card-body">#}
{#                            <div class="tab-content">#}
{#                                <div class="tab-pane active" id="work">#}
{#                                    <div class="row">#}
{#                                        {% include 'offer/_offer_block_cover.html.twig' with {'block':'rechnungPartEingang','offers': inquiries, 'storno':false} %}#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="tab-pane" id="invoicePartSend">#}
{#                                    <div class="row">#}
{#                                        {% include 'offer/_offer_block_cover.html.twig' with {'block':'bestaetigt','offers': inquiries, 'storno':false} %}#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="tab-pane" id="invoicePartIn">#}
{#                                    <div class="row">#}
{#                                        {% include 'offer/_offer_block_cover.html.twig' with {'block':'rechnungPartSend', 'offers': inquiries, 'storno':false} %}#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="tab-pane" id="invoiceSend">#}
{#                                    <div class="row">#}
{#                                        {% include 'offer/_offer_block_cover.html.twig' with {'block':'done', 'offers': inquiries, 'storno':false} %}#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="tab-pane" id="invoiceIn">#}
{#                                    <div class="row">#}
{#                                        {% include 'offer/_offer_block_cover.html.twig' with {'block':'rechnungEingangSend', 'offers': inquiries, 'storno':false} %}#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
        {% endif %}
{#        {% include 'offer/modals/_email_modal.html.twig' %}#}
{% endblock %}
