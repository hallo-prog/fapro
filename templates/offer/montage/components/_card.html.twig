{{ restore('viewedQuestions') }}
{% for k, context in offer.inquiry.context %}
    {% if context['questions'][question.id]['answer'] is defined and question.protocol != 'q' and question.protocol != 'p' %}
        {% set viewedQuestions = viewedQuestions|merge([question.id]) %}
        <div class="card my-1">
            {% include 'offer/montage/components/_card_body.html.twig' %}
         {#   <div class="card-body" {% if question.needImage %}{{ stimulus_controller('upload', {'offerId':offer.id, 'question':question.id, 'imgCount':(question.images|length+1)}) }}{% endif %}>
                <div class="row mb-2 radios">
                    <div class="col-md-3">
                        <p class="mb-0" style="font-weight: bold">{{ question.title ? question.title : question.name }}</p>
                    </div>
                    <div class="col-md-3">
                         {% if context['questions'][question.id]['answer'] is defined %}
                            {% include 'offer/types/rows/'~question.answerType~'.html.twig' with {'col1':6,'col2':6, 'aid': question.questionArea ?question.questionArea.id: 0}  %}
                         {% endif %}
                    </div>
                    <div class="col-md-1">
                        Â´<div style="cursor: pointer;width: 20px;">
                            <span class="d-none d-sm-block material-icons module_context_b1_{{ question.id }}">keyboard_double_arrow_right</span>
                            <span class="d-block d-sm-none material-icons module_context_b1_{{ question.id }}">keyboard_double_arrow_down</span>
                        </div>
                    </div>
                    <div class="col-md-3 p-0 mx-0">
                        <textarea style="height: auto;resize: initial;"  data-id="{{ question.id }}" class="form-control module_contexttext_change" id="module_context_text_{{ question.id }}" name="module_context[{{ question.id }}][text]">
                            {%- if context['questions'][question.id]['monteur']['text'] is defined %}{{ context['questions'][question.id]['monteur']['text'] }}{% endif -%}
                        </textarea>
                    </div>
                    {% if question.needImage %}
                        <div class="col-md-1">
                            <h4 style="color: {{ sfColor }}">
                                <input type="file" class="d-none" name="image[{{ question.id }}]"
                                        data-url="{{ path('ajax_upload_images', {'id':offer.id, 'question': question.id}) }}"
                                        data-upload-target="fileclick"
                                        accept="image/*" {{ stimulus_action('upload','addImagePreview','change') }}>
                                <button class="btn btn-light btn-sm p-1" type="button" {{ stimulus_action('upload','clickImage','click') }}>
                                    <span class="material-icons">add_a_photo</span> <span title="{{ 'm.imageAdd'|trans }}" class="material-icons">add_circle_outline</span></button>
                            </h4>
                        </div>
                    {% else %}
                        <div class="col-md-1"></div>
                    {% endif %}
                    <div class="col-md-1">
                        <input style="height: 0;width: 0" class="module_context_change" type="radio" data-offerid="{{ offer.id }}" data-id="{{ question.id }}" name="module_context[{{ question.id }}][ok]" id="module_context_ok_{{ question.id }}" value="1">
                        <label style="cursor: pointer;width: 20px;" for="module_context_ok_{{ question.id }}">
                            <span class="material-icons">thumbs_up_{% if context['questions'][question.id]['monteur']['ok'] is not defined or (context['questions'][question.id]['monteur']['ok'] is defined and context['questions'][question.id]['monteur']['ok'] != '1') %}off{% else %}{% endif %}_alt</span>
                        </label>
                    </div>
                </div>
                {% if question.needImage %}
                    <div class="row mb-3 radios" data-upload-target="preview">
                        {% for img in offer.images %}
                            {% if img.question.id == question.id %}
                                {% set i = loop.index-1 %}
                                {% include 'offer/montage/components/img_box.html.twig' with {'img':img, 'imagesCount': imagesCount, 'question': question} %}
                                {% set imagesCount = imagesCount+1 %}
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>#}
        </div>
    {% elseif question.id not in viewedQuestions and question.protocol == 'p' %}
        {% set viewedQuestions = viewedQuestions|merge([question.id]) %}
        <div class="card my-1">
            {% include 'offer/montage/components/_card_body.html.twig' %}
        </div>
    {% endif %}
{% endfor %}
{{ save('viewedQuestions') }}